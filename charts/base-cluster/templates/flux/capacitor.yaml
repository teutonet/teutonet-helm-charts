{{- if .Values.flux.capacitor.enabled }}
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: capacitor
  namespace: flux-system
  labels: {{- include "common.labels.standard" $ | nindent 4 }}
    app.kubernetes.io/component: capacitor
spec:
  chart:
    spec: {{- include "base-cluster.helm.chartSpec" (dict "repo" "onechart" "chart" "onechart" "context" $) | nindent 6 }}
  interval: 1h
  driftDetection:
    mode: enabled
  values:
    image:
      repository: ghcr.io/gimlet-io/capacitor
      tag: v0.4.2
    containerPort: 9000
    probe:
      enabled: true
      path: /
    resources:
      ignoreLimits: true
    serviceAccount: capacitor
{{- end }}
