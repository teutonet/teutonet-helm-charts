apiVersion: batch/v1
kind: CronJob
metadata:
  name: hello
spec:
  schedule: "0 * * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: ckan-mail
              image: busybox:1.28
              imagePullPolicy: IfNotPresent
              command:
                - /bin/sh
                - -c
                - "curl https://{{ .Values.ckan.ingress.hostname }}/api/3/action/ -H \"Authorization: Bearer $EMAIL_API_KEY\""
              env:
                - name: EMAIL_API_KEY
                  valueFrom:
                    secretKeyRef:
                      name: {{ printf "%s-%s-config" (include "common.names.fullname" $) "ckan" }}
                      key: emailApiKey
          restartPolicy: OnFailure
