{{- define "t8s-cluster.clusterClass.bootstrapConfigTemplate.kubeadm.spec" -}}
  {{- $_ := mustMerge . (pick .context "Values") -}}
joinConfiguration:
  nodeRegistration:
    kubeletExtraArgs: {{- toYaml (include "t8s-cluster.clusterClass.argsMapToArray" (dict "args" (include "t8s-cluster.clusterClass.kubeletExtraArgs" (dict "context" .context) | fromYaml)) | fromYamlArray) | nindent 6 }}
    imagePullSerial: false
  patches:
    directory: /etc/kubernetes/patches
files: {{- include "t8s-cluster.clusterClass.configTemplate.files" (dict "context" .context "gpu" .gpu) | nindent 2 }}
  {{- with include "t8s-cluster.clusterClass.preKubeadmCommands" (dict "context" .context) | fromYamlArray }}
preKubeadmCommands: {{- toYaml . | nindent 2 }}
  {{- end }}
  {{- with include "t8s-cluster.clusterClass.postKubeadmCommands" (dict) | fromYamlArray }}
postKubeadmCommands: {{- toYaml . | nindent 2 }}
  {{- end }}
{{- end -}}
