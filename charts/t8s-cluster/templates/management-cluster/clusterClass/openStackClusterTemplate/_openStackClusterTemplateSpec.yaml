{{/*
OpenStackClusterTemplate is immutable. We need to create new versions during upgrades.
Here we are generating a hash suffix.
*/}}
{{- define "t8s-cluster.clusterClass.openStackClusterTemplate.spec" -}}
  {{- $_ := set . "Values" .context.Values -}}
apiServerLoadBalancer:
  enabled: true
bastion:
  availabilityZone: {{ .Values.bastion.availabilityZone }}
  enabled: {{ .Values.bastion.enabled }}
  instance:
    cloudName: {{ include "t8s-cluster.clusterClass.cloudName" (dict) }}
    flavor: standard.1.1905
    identityRef:
      kind: Secret
      name: {{ include "t8s-cluster.clusterClass.getIdentityRefSecretName" .context }}
    image: Ubuntu 20.04
    sshKeyName: {{ .Values.bastion.sshKeyName }}
controlPlaneAvailabilityZones: {{- include "t8s-cluster.clusterClass.controlPlaneAvailabilityZones" .context | nindent 2 }}
cloudName: {{ include "t8s-cluster.clusterClass.cloudName" (dict) }}
disablePortSecurity: false
dnsNameservers: {{- include "t8s-cluster.clusterClass.dnsNameservers" .context | nindent 2 }}
identityRef:
  kind: Secret
  name: {{ include "t8s-cluster.clusterClass.getIdentityRefSecretName" .context }}
managedSecurityGroups: {{ include "t8s-cluster.clusterClass.managedSecurityGroups" .context }}
nodeCidr: 10.6.0.0/24
{{- end -}}