apiVersion: t8s-engine.teuto.net/v1alpha1
kind: TeutonetesCluster
metadata:
  name: {{ .Release.Name }}
  namespace: {{ .Release.Namespace}}
  labels: {{- include "common.labels.standard" . | nindent 4 }}
    t8s.teuto.net/sla: {{ .Values.metadata.serviceLevelAgreement | quote }}
    t8s.teuto.net/customer-id: {{ .Values.metadata.customerID | quote }}
    t8s.teuto.net/customer-name: {{ .Values.metadata.customerName | quote }}
    t8s.teuto.net/internal-name: {{ .Release.Name | quote }}
    t8s.teuto.net/role: workload
  {{- if or .Values.metadata.supportProjectUrl .Values.metadata.configGroupUrl .Values.metadata.gopassName .Values.metadata.remarks }}
  annotations:
    {{- with .Values.metadata.supportProjectUrl }}
    t8s.teuto.net/cluster_support_project_url: {{ . | quote}}
    {{ end }}
    {{- with .Values.metadata.configGroupUrl }}
    t8s.teuto.net/cluster_config_group_url: {{ . | quote }}
    {{ end }}
    {{- with .Values.metadata.gopassName }}
    t8s.teuto.net/gopass_name: {{ . | quote }}
    {{ end }}
    {{- with .Values.metadata.remarks }}
    t8s.teuto.net/remarks: {{ . | quote }}
    {{ end }}
  {{- end }}
spec:
  customerID: {{ .Values.metadata.customerID }}
  customerName: {{ .Values.metadata.customerName }}
  controlPlane:
    singleNode: {{ .Values.controlPlane.singleNode }}
    flavor: {{ .Values.controlPlane.flavor }}
  teutonetesCloudRef:
    kind: TeutonetesCloud
    name: {{ .Values.cloud }}
  {{- with .Values.version }}
  version: {{ printf "v%d.%d.%d" (.major | int) (.minor | int) (.patch | int) }}
  {{- end }}
  workers: {{- .Values.workers | toYaml | nindent 4 }}
  bastion:
    enabled: false
