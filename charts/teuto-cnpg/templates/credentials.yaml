{{- $roles := dict -}}
{{- if kindIs "string" .Values.roles -}}
  {{- $roles = .Values.roles | fromYamlArray -}}
{{- else -}}
  {{- $roles = .Values.roles -}}
{{- end -}}
{{- range $role := $roles -}}
{{- if ($role.passwordSecret).name }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $role.passwordSecret.name }}
  namespace: {{ $.Release.Namespace }}
data:
  password: {{ include "common.secrets.passwords.manage" (dict "secret" $role.passwordSecret.name "length" 40 "strong" false "providedValues" (list) "key" "password" "context" $ ) }}
  username: {{ $role.name | b64enc }}
---
{{- end }}
{{ end }}
